<div class="wrapper" id="wrapper">
  <div id="policy" class="policy2" *ngFor="let policy of policy$ | async">
      <div class="row1">


        <form [formGroup]="policyForm">
          <mat-form-field id="policySearch">
            <mat-label>{{this.id}}</mat-label>
            <input type="text"
            
                   matInput
                   formControlName="policyLevel"
                   required
                   [matAutocomplete]="autoGroup">
              <mat-autocomplete #autoGroup="matAutocomplete">
                <mat-optgroup *ngFor="let group of policyLevelOptions | async" [label]="group.level">
                  <mat-option *ngFor="let name of group.names" [value]="name" routerLink="/Policy/{{name}}" (click)="policySearch($event, name)" routerLinkActive="active">
                    {{name}}
                  </mat-option>
              </mat-optgroup>
            </mat-autocomplete>
          </mat-form-field>
        </form>
        

        <div class="item2" style="flex: 1; ">
          <p id="title" style="font-size: 20px;"> {{policy.Subtitle}}</p>
        </div>    

        <div class="item2" style="flex: 1; ">
          <p id="title" style="font-size: 20px;color: #06d6a0;">{{policy.Pstatus}}</p>
        </div>
      </div>

      <mat-tab-group >
        <mat-tab label="CMMC Information" style="overflow: none;">
          <p style="margin-top: 1%;" class="dditems">CMMC Number: {{policy.CMMCnumber}}</p>
          <br>
          <p class="dditems">Capability Name: {{policy.nudgid}}</p>
          <br>
          <p class="dditems">Capability Number: {{policy.Capabilitynumber}}</p>
          <br>
          <p class="dditems">Practice: {{policy.Practice}}</p>
          <br>
          <p class="dditems">Clarification: {{policy.Clarification}}</p>
        </mat-tab>

        <mat-tab label="NIST Information" style="overflow: none;">
        <p style="margin-top: 1%;" class="dditems">NIST Mapping: {{policy.NISTmapping}}</p>
        <br>
        <p class="dditems">NIST Value: {{policy.NISTvalue}}</p>
        <br>
      </mat-tab>
        <mat-tab label="References"> {{policy.References}}</mat-tab>
        <mat-tab label="Guidelines">
          <app-guidelines-page>
          </app-guidelines-page>
        </mat-tab>

      </mat-tab-group>
  </div>
    

  <!--THIS IS THE STANDARDS LIST-->
  <div id="standard3" class="standard4 ">

    <mat-list>
      <div class="flexContainer">
        <mat-list-item class="headerRow">
          <span class="listSpan idCol">
            Standard ID
          </span>
          <span class="listSpan descCol">
            Name
          </span>
        </mat-list-item>
      </div>
  
      <mat-list-item *ngFor="let standard of standards$ | async">
  
          <span class="listSpan idCol">
            {{ standard.idStandards }}    
            </span>
        <span class="listSpan descCol">
          {{standard.Standard}}
        </span>
  
       <span style="position: absolute; right: 0;">
          <button mat-icon-button>
            <mat-icon
              
              color="primary"
            >
            <!--(click)="updateStandards(standard.idStandards, userInput.value)"-->
              edit
            </mat-icon>
          </button>
  
      
          <button mat-icon-button>
            <mat-icon (click)="deleteStandards(standard.idStandards)" color="warn">
              delete
            </mat-icon>
          </button>
        </span> 
      </mat-list-item>
    </mat-list>
  
  </div>


  <div class ="editBar">
    <app-accordion-item *ngFor="let item of entries" 
      [entry]="item">
    </app-accordion-item> 
  </div>

  <!--THIS IS THE WEAKNESSES LIST-->

  <div
  cdkDropList
  id="weaknessDrop"
  class="weakness2"
  [cdkDropListData]="weaknessDrop"
  [cdkDropListConnectedTo]="[controlDrop]"
  (cdkDropListDropped)="drop($event)"
  [cdkDropListEnterPredicate]="controlsToWeaknesses">

     
    <mat-list>
      <div class="flexContainer">
        <mat-list-item class="headerRow">
          <span class="idCol">
            Weakness ID
          </span>
          <span class="nameCol">
            Name
          </span>
          <span class="descCol">
            Description
          </span>
          <span class="dateCol">
            Status
          </span>
          <span class="dateCol2">
            Completion Date
          </span>
          <span class="dateCol3">
            Cid
          </span>
          <input class="searchBox"  type="text" #searchWeaknesses id='searchWeaknesses' (keyup)="filterWeaknesses()" placeholder="search" />

        </mat-list-item>


      </div>
  
      <mat-list-item class="dragdropbox"  cdkDrag [cdkDragData]="weaknessElement" *ngFor="let weaknessElement of weaknesses$ | async">
          <!--The below ngIf is what applies the searchbar to the list-->
        <ng-container  *ngIf="weaknessElement.Wname.toLowerCase().indexOf(searchWeaknesses.value)!== -1 || weaknessElement.Wstatus.toLowerCase().indexOf(searchWeaknesses.value)!== -1|| weaknessElement.Wdescription.toLowerCase().indexOf(searchWeaknesses.value)!== -1 ">
         
          <span class="listSpan idCol" style="font-weight: bold;">
              {{ weaknessElement.idOrgWeaknesses }} 
            </span>
          <span class="listSpan nameCol" style="font-weight: bold;" >
            {{weaknessElement.Wname}}
          </span>
    
          <span class="listSpan descCol" style="font-weight: bold;">
            {{weaknessElement.Wdescription}}
          </span>
    
          <span class="listSpan dateCol" style="font-weight: bold;">
            {{weaknessElement.Wstatus}}
          </span>
  
          <span class="listSpan dateCol2" style="font-weight: bold;">
            {{weaknessElement.WcompletionDate | date:'M/d/yy'}}
          </span>

          <span class="listSpan dateCol3" style="font-weight: bold; ">
            {{weaknessElement.idOrgControls}}
          </span>
  
        <span class="listSpan dateCol4">
          <button mat-icon-button>
              <mat-icon
              (click)="openMilestones(weaknessElement.idOrgWeaknesses)"
              color="primary"
              >
              assignment
            </mat-icon>
          </button>
  
  
  
  
            <button mat-icon-button>
              <mat-icon
       
                color="primary"
              >
              <!--         (click)="updateWeaknesses(weaknessElement.idOrgWeaknesses, userInput.value)"-->
                edit
              </mat-icon>
            </button>
    
        
            <button mat-icon-button>
              <mat-icon (click)="deleteWeaknesses(weaknessElement.idOrgWeaknesses)" color="warn">
                delete
              </mat-icon>
            </button>
          </span> 

        </ng-container>

    
         
       
         
      </mat-list-item>
    </mat-list>
    
    
  </div>


    <!-- THIS IS THE CONTROLS LIST-->
    <div 
    id="controlDrop" 
    class="control2"
    cdkDropList

    [cdkDropListData]="controlDrop"
    [cdkDropListConnectedTo]="[weaknessDrop]"
    (cdkDropListDropped)="drop($event)"
    [cdkDropListEnterPredicate]="weaknessesToControls">

    <mat-list>
      <div class="flexContainer">
        <mat-list-item class="headerRow">
          <span class="idCol">
            Control ID
          </span>
          <span class="nameCol">
            Name
          </span>
          <span class="descCol">
            Description
          </span>
          <span class="dateCol">
            Date
          </span>
          <span class="dateCol2" style="margin-left: 6.5%;">
            Wid
          </span>
          <input class="searchBox" style="margin-left: 3px;" type="text" #searchControls id='searchControls' (keyup)="filterControls()" placeholder="search" />

        </mat-list-item>

      </div>

      <mat-list-item 
      id="controlDraggable"
      cdkDrag 
      *ngFor="let controlElement of controls$ | async"  
 
      [cdkDragData]="controlElement"

      >
        <ng-container style="display: flex;" *ngIf="controlElement.Cname.toLowerCase().indexOf(searchControls.value)!== -1 || controlElement.Coverview.toLowerCase().indexOf(searchControls.value)!== -1 ">

        <span class=" idCol" style="font-weight: bold;"
          >{{ controlElement.idOrgControls }}    </span
        >
        <span class=" nameCol" style="font-weight: bold;">
          {{controlElement.Cname}}
        </span>
        <span class=" descCol" style="font-weight: bold;">
          {{controlElement.Coverview}}
        </span>
        <span class=" dateCol" style="font-weight: bold;">
          {{controlElement.Cissuedate}}
        </span>
        <span class=" dateCol2" style="font-weight: bold; margin-left: 8%;">
          {{controlElement.idOrgWeaknesses}}
        </span>



      <span style="position: absolute; right: 0;">
        <button mat-icon-button>
          <mat-icon
          (click)="openProcedures(controlElement.idOrgControls)"
          color="primary"
          >
          assignment
        </mat-icon>
      </button>


          <button mat-icon-button>
            <mat-icon
              color="primary"
            >
            <!--              (click)="updateControls(controlElement.idOrgControls, userInput.value)"
-->
              edit
            </mat-icon>
          </button>

      
          <button mat-icon-button>
            <mat-icon (click)="deleteControls(controlElement.idOrgControls)" color="warn">
              delete
            </mat-icon>
          </button>
        </span> 
      </ng-container>
      </mat-list-item>
    </mat-list>

    </div>

</div>

